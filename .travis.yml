
dist: trusty
sudo: required
language: node_js
services:
  - docker
branches:
  only:
    - master
    - stable
    - petong/travis-ci
    - "/^v\\d+\\.\\d+\\.\\d+(-\\d+)?$/"
node_js:
  - '9'
  - '8'
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - gcc-4.8
      - g++-4.8
      - build-essential
      - libusb-1.0-0-dev
script:
  - yarn lint; yarn test;
  - NODE_ENV='test' node ./node_modules/nyc/bin/nyc.js ./node_modules/mocha/bin/_mocha --timeout 10000 --require babel-register && node ./node_modules/nyc/bin/nyc.js report --require babel-register --reporter=lcov && cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js
  - yarn build --dev
jobs:
  include:
  - stage: Deploy to stable
    if: branch = stable
    node_js: '8'
    script: skip
    deploy:
      provider: script
      script: docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"; npm run docker:release -- stable
      skip_cleanup: true
      on:
        all_branches: true
  - stage: Deploy to dev
    if: branch = master
    script: skip
    deploy:
      provider: script
      script: docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"; npm run docker:release -- dev
      skip_cleanup: true
      on:
        all_branches: true
env:
  global:
    - DOCKER_USERNAME=augurintegration
    - secure: "BF3mjGJ2+hWsdJUrm+0g1h5vq8XBsMBj9DnlfqoJXOjHSgeDBLnoDZqcLlEI7EBovxP/mz4aMELket0bgHfd72j5ov3UVBSy+PqM9q3suHytq15544+/PMgjOOU9G7SlJvSMW6UdsLhINB3X6waL5JN9PpoarcG4HQffU2XUjvagdBQHxZQBDwQyrzBXQgVW09LyKCwLYfdGYEjX2PVJTlJoKCEPT2XsdM/3sGbpYokHmSc9M1XE5a1RwThbrthZhIBRpJCZoe9sSaLmRXizoy/pCXnfuPZFeETYElBZP7WCr3KccCLPsm9ilEQzDd1kgz0nAqhcxgaGEMRoeUwK3sLYXajoZ8R4zxEn1CGhuunTltsz7eDjzqnB5YQgp4wzQke5MOeJBpB0zpohvP3SS2IlgeLLOc8a8/rx9os+M8akfDV4HNRt+H2QUUQfGi18pa4T5MpxjwSdvBAMhGmAMkgXhGjUJEVSLnqYZA4bndZacRNVvtzGzx4Yu+ymGhlsPPg4sNrfYr9h0LXCZvBRQJUTcQQY10AMBCfqpJkG5Zl3qpDFy3rTvwFblSFM2i4Rg26PJFLBSDfo2DENiyrJhXA91lljOP3EPdYepdSO8Fu7JFdNk8HBxwIw6H7z33qRisFBQLAdPQingHw/iyBeVL+3K/1YPBnubqsEs5TsS3U="
    - secure: "DMLAQUAoS94gaJZIdcJWUk3aTP2ZAyiArCqU0OtJeOiTQHh9DPMZ5oywjJtj7kucwBu1uY4GzlPyokgtngWCEAGxpkc3J4Jfd7/mAbx59bHbEZURTOu4onJ7BzNS/V1mdZomVAJezlYBgImaHVfCflwz3g7wk7NPZnmxtlJlUKM="
    - secure: "VxySk4B7HqpbSwBNEb8qBbD7j9W2nRGo8hT0mFdK7uZmiqp404OAb+HUoR9ctPzRCQBsZTQIYxUOk5Dht0vavVW1WcTl9MXw5EjABJRb1K0zOWRhR/BFrNScjrw/mHrmwaLy0Ft2rzCwVJAAge4aPf/G/4mkC1yNdVhHU8uQXFg="
